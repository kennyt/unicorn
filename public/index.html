<!DOCTYPE html>
<html>
<head>
  <title>stream</title>
  <link rel="stylesheet" type="text/css" href="style.css">

  <script src="/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="/bower_components/bower-froogaloop/froogaloop.js"></script>
</head>
<body>
  <h1 class="hero-heading">It's coming</h1>
  <h1 class="centerText"></h1>
  <div class="view-port">
    <iframe class="clip current" id="1" src="http://player.vimeo.com/video/101441424?api=1&autoplay=1&player_id=1&hd_off=1"  width="800" height="650" frameborder="0" autoplay></iframe>
    <iframe class="clip hidden" id="2" src="http://player.vimeo.com/video/92367692?api=1&player_id=2&hd_off=1"  width="800" height="650" frameborder="0"></iframe>
  </div>
  <div class="media tc"></div>
  <div class="media bi"></div>
  <div class="media sfe"></div>
  <div class="media wired"></div>
  <div class="media yahoo"></div>
  <div class="media forbes"></div>
  <audio src="audio/song.mp3" autoplay></audio>
  <script>

    $(function() {
        var $view = $('.view-port');
        var id = 2;
        $('audio')[0].currentTime = 4.45;

        var words = ['amazing', 'unbelieveable','new', 'fucking sexy', 'perfect', 'inspiring', 'insane', 'better', 'greater', 'beautiful', 'gorgeous', 'different', 'unique', 'special', 'stronger', 'faster'];

        var vimeoIds = ['101441424', '92367692', '96846520', '111331210', '104799259', '115541651', '118336448', '121495520', '98548134', '100541681', '100541681', '100541681', '122633176', '121124509', '116022179', '114950712', '101584491'];

        setInterval(function(){
          var newVid = $('.hidden');
          var currentVid = $('.current');
          var randSrc = vimeoIds[Math.floor(Math.random() * vimeoIds.length)];

          setTimeout(function(){
            newVid.removeClass('hidden').addClass('current');
            $(currentVid).remove();
            appendPlayer(randSrc);
            appendWord();
          }, 1000);

          setTimeout(function(){
            dimLights();
          // }, 89000)
          }, 2000)
        }, 7000);


        var player = $($('iframe')[0]);
        var playerOrigin = 'https://player.vimeo.com';

        // Listen for messages from the player
        if (window.addEventListener) {
          window.addEventListener('message', onMessageReceived, false);
        }
        else {
          window.attachEvent('onmessage', onMessageReceived, false);
        }

        function onMessageReceived(event) {
            // Handle messages from the vimeo player only
            if (!(/^https?:\/\/player.vimeo.com/).test(event.origin)) {
                return false;
            }

            if (playerOrigin === '*') {
                playerOrigin = event.origin;
            }

            if(JSON.parse(event.data).event === "ready"){
              post(null, "setVolume", 0.000001, event.source);

              // setTimeout(function(){
                post(null, "play", null, event.source);
              // }, 4000);

              $f($('.hidden')[0]).api('getduration', function(dur){
                console.log(dur);
                var rand = Math.random() * (dur - 20);
                post(null, "seekTo", rand, event.source);
              });
            }
        }

        function post(player, action, value, playerWindow) {
          var data = {
            method: action
          };
          
          if (value) {
            data.value = value;
          }
          
          var message = JSON.stringify(data);
          if(player === null){
            return playerWindow.postMessage(data, 'http://player.vimeo.com');
          } else {
            return player[0].contentWindow.postMessage(data, 'http://player.vimeo.com');
          }
        }

        function appendPlayer(src) {
          console.log(src);
          id++;
          var newFrame = '<iframe class="clip hidden" id="'+id+'" src="http://player.vimeo.com/video/'+src+'?api=1&player_id='+id+'&hd_off=1"  width="800" height="650" frameborder="0" \
            ></iframe>';

          $('.view-port').append(newFrame)
        };

        function appendWord(){
          var randomWord = words[Math.floor(Math.random() * words.length)];
          $('.centerText').html(randomWord);
          $('.centerText').css('opacity', '1');
          setTimeout(function(){
            $('.centerText').animate({opacity: 0}, 1000, function(){
            });
          }, 2500);
        };

        function dimLights(){
          $('body').css('background-color', '#303030');
          $('.media').animate({opacity: 0.8}, 5000);
        }
    });
  </script>
</body>
</html>